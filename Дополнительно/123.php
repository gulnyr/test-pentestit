<?php
if (isset($_POST['login'])) { $login = $_POST['login']; if ($login == '') { unset($login);} }
if (isset($_POST['password'])) { $password=$_POST['password']; if ($password =='') { unset($password);} }


if (empty($login) or empty($password))
{
    die ("Вы ввели не всю информацию, вернитесь назад и заполните все поля!");
}

$login = stripslashes($login);
$login = htmlspecialchars($login);
$password = stripslashes($password);
$password = htmlspecialchars($password);


$login = trim($login);
$password = trim($password);


require_once __DIR__ . './pdo_connect.php';


$dbpdo = $dbh->prepare("SELECT id FROM users WHERE login=':login'");

$dbpdo->bindParam(':login', $login);

$dbpdoe = $dbpdo->execute();

while ($row = $dbpdo->fetch(PDO::FETCH_ASSOC)) {
    return $row['id'];
}

if (!empty($row['id'])) {
    die ("Извините, введённый вами логин уже зарегистрирован. Введите другой логин.");
}


$dbpdo2 = $dbh->prepare("INSERT INTO users (login, password) VALUES(:login, :password)");
$dbpdo2->bindParam(':login', $login2);
$dbpdo2->bindParam(':position', $password2);
$dbpdoe2 = $dbpdo2->execute();

var_dump($dbpdo2);
var_dump($dbpdo);

// Проверяем, есть ли ошибки

if ($dbpdoe2 == true)
{
    echo "Вы успешно зарегистрированы! Теперь вы можете зайти на сайт";
}
else {
    echo "Ошибка! Вы не зарегистрированы.";
}
?>